<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>俱乐部入驻 - 游戏陪玩服务平台</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1a1a1a; /* Dark background */
            color: #f0f0f0; /* Light text color */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .onboarding-container {
            background-color: #222; /* Darker background for container */
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 700px;
            text-align: center;
        }
        .onboarding-container h2 {
            color: #00a8e8; /* Tencent-like blue */
            margin-bottom: 30px;
            font-size: 28px;
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .step {
            padding: 10px 20px;
            border-radius: 20px;
            background-color: #333;
            color: #aaa;
            margin: 0 10px;
            font-weight: bold;
        }
        .step.active {
            background-color: #00a8e8;
            color: white;
        }
        .form-section {
            text-align: left;
            margin-bottom: 30px;
        }
        .form-section h3 {
            color: #f0f0f0;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #aaa;
        }
        .input-group input[type="text"],
        .input-group input[type="email"],
        .input-group input[type="number"],
        .input-group textarea,
        .input-group select {
            width: calc(100% - 22px); /* Adjust for padding and border */
            padding: 12px 10px;
            border: 1px solid #444;
            border-radius: 5px;
            font-size: 16px;
            background-color: #333;
            color: #f0f0f0;
        }
        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        .input-group input[type="file"] {
            padding: 5px 0;
            color: #f0f0f0;
        }
        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            border-color: #00a8e8;
            outline: none;
            box-shadow: 0 0 5px rgba(0, 168, 232, 0.5);
        }
        .button-group {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
        }
        .button-group button {
            padding: 12px 25px;
            background-color: #00a8e8;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .button-group button:hover {
            background-color: #007bb5;
        }
        .button-group button.prev {
            background-color: #555;
        }
        .button-group button.prev:hover {
            background-color: #444;
        }
        ul {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }
        ul li {
            background-color: #333;
            border: 1px solid #444;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 5px;
            color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="onboarding-container">
        <h2>俱乐部入驻申请</h2>

        <div class="step-indicator">
            <span class="step active" id="step1">1. 资质信息</span>
            <span class="step" id="step2">2. 陪玩者信息</span>
            <span class="step" id="step3">3. 提交审核</span>
        </div>

        <div id="form-step1" class="form-section">
            <h3>俱乐部资质信息</h3>
            <div class="input-group">
                <label for="club-name">俱乐部名称</label>
                <input type="text" id="club-name" placeholder="请输入俱乐部全称">
            </div>
            <div class="input-group">
                <label for="license-number">营业执照注册号</label>
                <input type="text" id="license-number" placeholder="请输入营业执照注册号">
            </div>
            <div class="input-group">
                <label for="legal-person">法人姓名</label>
                <input type="text" id="legal-person" placeholder="请输入法人姓名">
            </div>
            <div class="input-group">
                <label for="contact-phone">联系电话</label>
                <input type="text" id="contact-phone" placeholder="请输入俱乐部联系电话">
            </div>
            <div class="input-group">
                <label for="contact-email">联系邮箱</label>
                <input type="email" id="contact-email" placeholder="请输入俱乐部联系邮箱">
            </div>
            <div class="input-group">
                <label for="business-license-upload">上传营业执照照片</label>
                <input type="file" id="business-license-upload" accept="image/*">
            </div>
            <div class="button-group">
                <button onclick="nextStep(2)">下一步</button>
            </div>
        </div>

        <div id="form-step2" class="form-section" style="display: none;">
            <h3>陪玩者信息管理</h3>
            <p style="color: #aaa;">请添加您的陪玩者信息，至少添加一名陪玩者。</p>
            <div class="input-group">
                <label for="player-name">陪玩者姓名/昵称</label>
                <input type="text" id="player-name" placeholder="请输入陪玩者姓名或昵称">
            </div>
            <div class="input-group">
                <label for="player-id-card">陪玩者身份证号</label>
                <input type="text" id="player-id-card" placeholder="请输入陪玩者身份证号">
            </div>
            <div class="input-group">
                <label for="player-game">擅长游戏</label>
                <input type="text" id="player-game" placeholder="例如：王者荣耀, 英雄联盟">
            </div>
            <div class="input-group">
                <label for="player-skill">技能证明/段位截图</label>
                <input type="file" id="player-skill" accept="image/*">
            </div>
            <div class="button-group">
                <button>添加陪玩者</button>
            </div>
            <hr style="margin: 30px 0; border-color: #333;">
            <h4 style="color: #f0f0f0;">已添加陪玩者 (示例)</h4>
            <ul>
                <li>小明 - 王者荣耀 (已审核)</li>
                <li>小红 - 英雄联盟 (待审核)</li>
            </ul>
            <div class="button-group">
                <button class="prev" onclick="nextStep(1)">上一步</button>
                <button onclick="nextStep(3)">下一步</button>
            </div>
        </div>

        <div id="form-step3" class="form-section" style="display: none;">
            <h3>提交审核</h3>
            <p style="color: #aaa;">请确认您填写的所有信息无误，提交后平台将进行审核。</p>
            <p style="color: #aaa;">审核结果将通过站内信和注册邮箱通知您。</p>
            <div class="button-group">
                <button class="prev" onclick="nextStep(2)">上一步</button>
                <button>提交申请</button>
            </div>
        </div>
    </div>

    <script type="module">
        import ClubAuthService from '../src/services/club-auth-service.js'

        // 存储表单数据
        let formData = {
            step1: {},
            step2: {
                players: []
            }
        }

        function nextStep(stepNum) {
            document.getElementById('form-step1').style.display = 'none';
            document.getElementById('form-step2').style.display = 'none';
            document.getElementById('form-step3').style.display = 'none';

            document.getElementById('step1').classList.remove('active');
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.remove('active');

            document.getElementById('form-step' + stepNum).style.display = 'block';
            document.getElementById('step' + stepNum).classList.add('active');

            // 如果是第三步，显示汇总信息
            if (stepNum === 3) {
                displaySummary();
            }
        }

        // 保存第一步数据
        function saveStep1Data() {
            formData.step1 = {
                clubName: document.getElementById('club-name').value.trim(),
                licenseNumber: document.getElementById('license-number').value.trim(),
                legalPerson: document.getElementById('legal-person').value.trim(),
                contactPhone: document.getElementById('contact-phone').value.trim(),
                contactEmail: document.getElementById('contact-email').value.trim()
            }
        }

        // 添加陪玩者
        function addPlayer() {
            const playerName = document.getElementById('player-name').value.trim();
            const playerIdCard = document.getElementById('player-id-card').value.trim();
            const playerGame = document.getElementById('player-game').value.trim();

            if (!playerName || !playerIdCard || !playerGame) {
                alert('请填写完整的陪玩者信息');
                return;
            }

            const player = {
                name: playerName,
                idCard: playerIdCard,
                game: playerGame,
                status: 'pending'
            }

            formData.step2.players.push(player);
            updatePlayersList();
            
            // 清空表单
            document.getElementById('player-name').value = '';
            document.getElementById('player-id-card').value = '';
            document.getElementById('player-game').value = '';
        }

        // 更新陪玩者列表显示
        function updatePlayersList() {
            const playersList = document.getElementById('players-list');
            playersList.innerHTML = '';

            formData.step2.players.forEach((player, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    ${player.name} - ${player.game} (${player.status})
                    <button onclick="removePlayer(${index})" style="margin-left: 10px; background: #dc3545; color: white; border: none; border-radius: 3px; padding: 2px 8px; cursor: pointer;">删除</button>
                `;
                playersList.appendChild(li);
            });
        }

        // 删除陪玩者
        function removePlayer(index) {
            formData.step2.players.splice(index, 1);
            updatePlayersList();
        }

        // 显示汇总信息
        function displaySummary() {
            const summaryDiv = document.getElementById('summary-content');
            if (!summaryDiv) return;

            let html = `
                <h4 style="color: #f0f0f0; margin-bottom: 15px;">申请信息汇总</h4>
                <div style="background: #333; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                    <strong>俱乐部信息:</strong><br>
                    名称: ${formData.step1.clubName}<br>
                    法人: ${formData.step1.legalPerson}<br>
                    联系电话: ${formData.step1.contactPhone}<br>
                    邮箱: ${formData.step1.contactEmail}<br>
                    营业执照号: ${formData.step1.licenseNumber}
                </div>
                <div style="background: #333; padding: 15px; border-radius: 5px;">
                    <strong>陪玩者信息 (${formData.step2.players.length}名):</strong><br>
            `;

            formData.step2.players.forEach(player => {
                html += `${player.name} - ${player.game}<br>`;
            });

            html += `</div>`;
            summaryDiv.innerHTML = html;
        }

        // 提交申请
        async function submitApplication() {
            // 验证数据
            if (!formData.step1.clubName || !formData.step1.contactEmail || !formData.step1.contactPhone) {
                alert('请填写完整的俱乐部信息');
                return;
            }

            if (formData.step2.players.length === 0) {
                alert('请至少添加一名陪玩者');
                return;
            }

            const submitButton = document.querySelector('#form-step3 button:last-child');
            submitButton.disabled = true;
            submitButton.textContent = '提交中...';

            try {
                // 生成随机密码（实际应用中应该让用户设置密码）
                const tempPassword = 'Club123!' + Math.random().toString(36).slice(-4);
                
                // 调用俱乐部注册服务
                const result = await ClubAuthService.registerWithEmail(
                    formData.step1.contactEmail,
                    tempPassword,
                    formData.step1.clubName,
                    formData.step1.legalPerson,
                    formData.step1.contactPhone
                );

                alert('申请提交成功！请检查邮箱确认邮件，并等待管理员审核。');
                console.log('俱乐部注册成功:', result);
                
                // 跳转到登录页面
                setTimeout(() => {
                    window.location.href = 'merchant_login.html';
                }, 2000);

            } catch (error) {
                console.error('俱乐部注册失败:', error);
                
                if (error.message.includes('已存在') || error.message.includes('already')) {
                    alert('该邮箱已注册，请直接登录或使用其他邮箱');
                } else {
                    alert('提交失败: ' + error.message);
                }
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = '提交申请';
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('俱乐部入驻页面加载完成');
            
            // 为第一步的表单添加数据保存
            const step1Inputs = document.querySelectorAll('#form-step1 input');
            step1Inputs.forEach(input => {
                input.addEventListener('blur', saveStep1Data);
            });

            // 为添加陪玩者按钮添加事件
            const addPlayerButton = document.querySelector('#form-step2 button');
            if (addPlayerButton) {
                addPlayerButton.addEventListener('click', addPlayer);
            }

            // 为提交按钮添加事件
            const submitButton = document.querySelector('#form-step3 button:last-child');
            if (submitButton) {
                submitButton.addEventListener('click', submitApplication);
            }

            // 创建汇总显示区域
            const step3Section = document.getElementById('form-step3');
            if (step3Section) {
                const summaryDiv = document.createElement('div');
                summaryDiv.id = 'summary-content';
                summaryDiv.style.marginBottom = '20px';
                step3Section.insertBefore(summaryDiv, step3Section.querySelector('.button-group'));
            }

            // 创建陪玩者列表容器
            const step2Section = document.getElementById('form-step2');
            if (step2Section) {
                const playersList = document.createElement('ul');
                playersList.id = 'players-list';
                playersList.style.marginTop = '15px';
                step2Section.insertBefore(playersList, step2Section.querySelector('.button-group'));
            }
        });
    </script>
</body>
</html>